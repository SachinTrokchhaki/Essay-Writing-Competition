<!-- user/templates/user/profile.html -->
{% extends 'core/base.html' %}
{% load static %}

{% block title %}My Dashboard - Competition Hub{% endblock %}

{% block extra_css %}
<style>
    .stat-card {
        border-radius: 10px;
        transition: transform 0.3s;
        border: none;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .stat-card:hover {
        transform: translateY(-5px);
    }
    .status-badge {
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 500;
    }
    .status-pending { background-color: #fff3cd; color: #856404; }
    .status-accepted { background-color: #d4edda; color: #155724; }
    .status-rejected { background-color: #f8d7da; color: #721c24; }
    .competition-card {
        border-left: 4px solid #0d6efd;
        transition: all 0.3s;
    }
    .competition-card:hover {
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    .deadline-badge {
        background: linear-gradient(45deg, #ff6b6b, #ff8e53);
        color: white;
    }
    .resubmit-btn {
        background: linear-gradient(45deg, #28a745, #20c997);
        border: none;
    }
    /* New CSS for 6-column layout on mobile */
    @media (max-width: 768px) {
        .col-md-2 {
            flex: 0 0 auto;
            width: 33.333333%;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4 mt-5">
    <!-- Welcome Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-gradient-primary text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h1 class="h3 mb-1 text-dark">ðŸ‘‹ Welcome back, {% if user.first_name %}{{ user.first_name }}{% else %}{{ user.username }}{% endif %}!</h1>
                            <p class="mb-0 opacity-75 text-dark">Track your submissions and discover new competitions</p>
                        </div>
                        <div class="text-end">
                            <p class="mb-1">Member since {{ user.created_at|date:"M Y" }}</p>
                            <a href="{% url 'user:edit_profile' %}" class="btn btn-light btn-sm">
                                <i class="fas fa-cog me-1"></i> Edit Profile
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Stats - Updated for 6 stats -->
    <div class="row mb-4">
        <div class="col-md-2 col-6 mb-3">
            <div class="card stat-card">
                <div class="card-body text-center">
                    <h2 class="text-primary">{{ total_submissions|default:"0" }}</h2>
                    <p class="text-muted mb-0">Total</p>
                </div>
            </div>
        </div>
        <div class="col-md-2 col-6 mb-3">
            <div class="card stat-card">
                <div class="card-body text-center">
                    <h2 class="text-info">{{ draft_count|default:"0" }}</h2>
                    <p class="text-muted mb-0">Drafts</p>
                </div>
            </div>
        </div>
        <div class="col-md-2 col-6 mb-3">
            <div class="card stat-card">
                <div class="card-body text-center">
                    <h2 class="text-secondary">{{ submitted_count|default:"0" }}</h2>
                    <p class="text-muted mb-0">Submitted</p>
                </div>
            </div>
        </div>
        <div class="col-md-2 col-6 mb-3">
            <div class="card stat-card">
                <div class="card-body text-center">
                    <h2 class="text-warning">{{ pending_count|default:"0" }}</h2>
                    <p class="text-muted mb-0">Review</p>
                </div>
            </div>
        </div>
        <div class="col-md-2 col-6 mb-3">
            <div class="card stat-card">
                <div class="card-body text-center">
                    <h2 class="text-success">{{ accepted_count|default:"0" }}</h2>
                    <p class="text-muted mb-0">Accepted</p>
                </div>
            </div>
        </div>
        <div class="col-md-2 col-6 mb-3">
            <div class="card stat-card">
                <div class="card-body text-center">
                    <h2 class="text-danger">{{ rejected_count|default:"0" }}</h2>
                    <p class="text-muted mb-0">Rejected</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Left Column: Active Competitions -->
        <div class="col-lg-8">
            <!-- Active Competitions -->
            <div class="card mb-4">
                <div class="card-header bg-white border-0 d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="fas fa-trophy text-warning me-2"></i> Open Competitions</h5>
                    <span class="badge bg-primary">{{ active_competitions|length|default:"0" }} available</span>
                </div>
                <div class="card-body">
                    {% if active_competitions %}
                        <div class="row">
                            {% for competition in active_competitions %}
                            <div class="col-md-6 mb-3">
                                <div class="card competition-card h-100">
                                    <div class="card-body">
                                        <h6 class="card-title">{{ competition.title|truncatechars:50 }}</h6>
                                        <p class="card-text small text-muted mb-2">
                                            {{ competition.description|truncatechars:80 }}
                                        </p>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span class="badge deadline-badge">
                                                <i class="fas fa-clock me-1"></i> 
                                                {% if competition.days_left %}
                                                    {{ competition.days_left }} days left
                                                {% else %}
                                                    Active
                                                {% endif %}
                                            </span>
                                            <a href="{% url 'competition:detail' competition.pk %}" class="btn btn-primary btn-sm">View Details</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-4">
                            <i class="fas fa-trophy fa-3x text-muted mb-3"></i>
                            <p class="text-muted">No active competitions at the moment</p>
                            <p class="small text-muted">Check back soon for new opportunities!</p>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Your Submissions -->
            <div class="card">
                <div class="card-header bg-white border-0 d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="fas fa-file-alt text-primary me-2"></i> Your Submissions</h5>
                    {% if recent_essays %}
                        <a href="{% url 'user:my_essays' %}" class="btn btn-outline-primary btn-sm">View All</a>
                    {% endif %}
                </div>
                <div class="card-body">
                    {% if recent_essays %}
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Essay Title</th>
                                        <th>Competition</th>
                                        <th>Submitted</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for essay in recent_essays %}
                                    <tr>
                                        <td>{{ essay.title|truncatechars:30|default:"Untitled" }}</td>
                                        <td>
                                            {% if essay.competition %}
                                                {{ essay.competition.title|truncatechars:20 }}
                                            {% else %}
                                                No Competition
                                            {% endif %}
                                        </td>
                                        <td>{{ essay.submitted_at|date:"M d"|default:"-" }}</td>
                                        <td>
                                            {% if essay.status == 'draft' %}
                                                <span class="badge bg-secondary">
                                                    <i class="fas fa-edit me-1"></i> Draft
                                                </span>
                                            {% elif essay.status == 'submitted' %}
                                                <span class="badge bg-info">
                                                    <i class="fas fa-paper-plane me-1"></i> Submitted
                                                </span>
                                            {% elif essay.status == 'pending_review' %}
                                                <span class="badge bg-warning text-dark">
                                                    <i class="fas fa-clock me-1"></i> Under Review
                                                </span>
                                            {% elif essay.status == 'accepted' %}
                                                <span class="badge bg-success">
                                                    <i class="fas fa-check-circle me-1"></i> Accepted
                                                </span>
                                            {% elif essay.status == 'rejected' %}
                                                <span class="badge bg-danger">
                                                    <i class="fas fa-times-circle me-1"></i> Rejected
                                                </span>
                                            {% else %}
                                                <span class="badge bg-secondary">Unknown</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="text-center py-4">
                            <i class="fas fa-file-alt fa-3x text-muted mb-3"></i>
                            <p class="text-muted">No submissions yet</p>
                            <a href="{% url 'core:home' %}#competitions" class="btn btn-primary">Browse Competitions</a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Right Column: Stats & Resubmissions -->
        <div class="col-lg-4">
            <!-- Success Rate & Stats -->
            <div class="card mb-4">
                <div class="card-header bg-white border-0">
                    <h5 class="mb-0"><i class="fas fa-chart-bar text-success me-2"></i> Your Performance</h5>
                </div>
                <div class="card-body">
                    <div class="text-center mb-4">
                        <div class="display-4 fw-bold text-success">{{ success_rate|default:"0"|floatformat:0 }}%</div>
                        <p class="text-muted">Acceptance Rate</p>
                    </div>
                    
                    <div class="progress mb-3" style="height: 20px;">
                        <div class="progress-bar bg-success" style="width: {{ success_rate|default:0 }}%"></div>
                    </div>
                    
                    <div class="row text-center">
                        <div class="col-6 mb-3">
                            <div class="h5 text-info">{{ draft_count|default:"0" }}</div>
                            <small class="text-muted">Drafts</small>
                        </div>
                        <div class="col-6 mb-3">
                            <div class="h5 text-secondary">{{ submitted_count|default:"0" }}</div>
                            <small class="text-muted">Submitted</small>
                        </div>
                        <div class="col-6">
                            <div class="h5 text-warning">{{ pending_count|default:"0" }}</div>
                            <small class="text-muted">Under Review</small>
                        </div>
                        <div class="col-6">
                            <div class="h5 text-success">{{ accepted_count|default:"0" }}</div>
                            <small class="text-muted">Accepted</small>
                        </div>
                        <div class="col-6">
                            <div class="h5 text-danger">{{ rejected_count|default:"0" }}</div>
                            <small class="text-muted">Rejected</small>
                        </div>
                        <div class="col-6">
                            <div class="h5 text-primary">{{ total_submissions|default:"0" }}</div>
                            <small class="text-muted">Total</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Links -->
            <div class="card">
                <div class="card-header bg-white border-0">
                    <h5 class="mb-0"><i class="fas fa-bolt text-info me-2"></i> Quick Actions</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="{% url 'core:home' %}#competitions" class="btn btn-outline-primary btn-block">
                            <i class="fas fa-search me-2"></i> Browse Competitions
                        </a>
                        <a href="{% url 'user:my_essays' %}" class="btn btn-outline-success btn-block">
                            <i class="fas fa-file-alt me-2"></i> View All Essays
                        </a>
                        <a href="{% url 'user:edit_profile' %}" class="btn btn-outline-secondary btn-block">
                            <i class="fas fa-user-edit me-2"></i> Edit Profile
                        </a>
                        <a href="{% url 'user:logout' %}" class="btn btn-outline-danger btn-block">
                            <i class="fas fa-sign-out-alt me-2"></i> Logout
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Add animation to stats cards
    document.addEventListener('DOMContentLoaded', function() {
        // Animate stats cards
        const statCards = document.querySelectorAll('.stat-card');
        statCards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                card.style.transition = 'opacity 0.5s, transform 0.5s';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, index * 100);
        });
    });
</script>
{% endblock %}~